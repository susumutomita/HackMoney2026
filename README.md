# HackMoney2026

# ZeroKey Treasury

> **AI Agent API Marketplace with Execution Firewall**

ZeroKey Treasuryは、AIエージェントがAPIサービスを自律的に発見・交渉・決済する際の「実行ファイアウォール」です。x402プロトコルとUSDC決済を組み合わせ、安全なAgent-to-Agent (A2A) マーケットプレイスを実現します。

---

## 🎯 コンセプト

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    AI Agent API Marketplace                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────┐      A2A交渉        ┌──────────────┐                 │
│  │  Client AI   │ ←─────────────────→ │ Provider AI  │                 │
│  │  (利用者)    │   価格・条件調整     │ (サービス)   │                 │
│  └──────┬───────┘                     └──────────────┘                 │
│         │                                                               │
│         │ 交渉成立 → 支払い実行要求                                     │
│         ▼                                                               │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │              ZeroKey Execution Firewall                      │      │
│  │  • トランザクション意図のセマンティック分析 (LLM)            │      │
│  │  • ポリシー適合チェック（予算、ホワイトリスト、レート制限）  │      │
│  │  • 詐欺・異常パターン検出                                    │      │
│  └──────┬───────────────────────────────────────────────────────┘      │
│         │ APPROVED / REJECTED                                           │
│         ▼                                                               │
│  ┌──────────────────────────────────────────────────────────────┐      │
│  │              x402 Payment + On-chain Guard                   │      │
│  │  • HTTP 402 Payment Required プロトコル                      │      │
│  │  • USDC/ステーブルコイン決済                                 │      │
│  │  • オンチェーン承認記録 (ZeroKeyGuard.sol)                   │      │
│  └──────────────────────────────────────────────────────────────┘      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🚀 ユースケース: AI秘書がAPIサービスを利用

```
[企業のAI秘書] 「この契約書を英語に翻訳して」
        │
        ▼ A2A Discovery & Negotiation
[翻訳サービスA] 「$0.05/1000トークン」
[翻訳サービスB] 「$0.03/1000トークン」
[翻訳サービスC] 「$0.01/1000トークン」← 怪しい新規プロバイダ
        │
        ▼ 交渉結果: サービスB選択 ($0.03)
        │
        ▼ ZeroKey Firewall
    ┌────────────────────────────────────────┐
    │ LLM分析結果:                           │
    │ • 目的: 業務文書翻訳 ✅               │
    │ • 金額: $0.03 (予算内) ✅             │
    │ • プロバイダ: 信頼スコア 85/100 ✅    │
    │ • リスク: LOW                          │
    │ → APPROVED                             │
    └────────────────────────────────────────┘
        │
        ▼ x402 Payment
    HTTP 402 → Payment Proof → API Response
```

### Firewallがブロックするケース

| ケース           | 理由                           |
| ---------------- | ------------------------------ |
| 予算超過         | 日次上限$100を超える利用       |
| 不審なプロバイダ | 新規 + 極端に安い = 詐欺リスク |
| 業務外利用       | ゲーム翻訳、個人用途など       |
| 異常パターン     | 短時間に大量リクエスト         |

---

## 🏗️ アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Frontend (Next.js 15)                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │  Dashboard   │  │  Marketplace │  │  Negotiation │  │   History    │    │
│  │  (概要)      │  │  (プロバイダ) │  │  (A2A交渉)  │  │  (履歴)      │    │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘    │
└─────────────────────────────────┬──────────────────────────────────────────┘
                                  │
                     WebSocket + REST API
                                  │
┌─────────────────────────────────┼──────────────────────────────────────────┐
│                           Backend (Hono)                                    │
│  ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐     │
│  │ A2A Gateway       │   │ Firewall Engine   │   │ x402 Handler      │     │
│  │ - Discovery       │   │ - LLM Analyzer    │   │ - Payment Req     │     │
│  │ - Negotiation     │   │ - Policy Check    │   │ - Verify Proof    │     │
│  │ - Message Relay   │   │ - Risk Scoring    │   │ - Settlement      │     │
│  └─────────┬─────────┘   └─────────┬─────────┘   └─────────┬─────────┘     │
└────────────┼─────────────────────────────────────────────────┼─────────────┘
             │                       │                         │
             ▼                       ▼                         ▼
┌───────────────────┐   ┌───────────────────┐   ┌───────────────────────────┐
│ Agent Registry    │   │ SQLite DB         │   │ Blockchain (Base Sepolia) │
│ (Provider List)   │   │ (History)         │   │ - ZeroKeyGuard.sol        │
└───────────────────┘   └───────────────────┘   │ - USDC Payments           │
                                                └───────────────────────────┘
```

---

## ⚡ クイックスタート

```bash
# 1. クローンとインストール
git clone https://github.com/susumutomita/ZeroKey-Treasury.git
cd ZeroKey-Treasury
pnpm install
cd packages/contracts && forge install && cd ../...

# 2. 環境設定
cp .env.example .env
# .envを編集: ANTHROPIC_API_KEY を追加

# 3. すべて起動
pnpm dev:all

# フロントエンド: http://localhost:3000
# バックエンド:   http://localhost:3001
```

---

## 📋 主な機能

| 機能                   | 説明                                           |
| ---------------------- | ---------------------------------------------- |
| **A2A Gateway**        | AIエージェント間のサービス検索・価格交渉       |
| **Execution Firewall** | LLMによるセマンティック分析 + ポリシーチェック |
| **x402 Payment**       | HTTP 402プロトコルによるUSDC決済               |
| **On-chain Guard**     | 承認決定をブロックチェーンに記録               |
| **Provider Registry**  | サービスプロバイダの信頼スコア管理             |
| **フェイルセーフ**     | 分析失敗時はデフォルトでブロック               |

---

## 🛠️ 技術スタック

| レイヤー                 | 技術                                |
| ------------------------ | ----------------------------------- |
| **スマートコントラクト** | Solidity 0.8.24 · Foundry           |
| **バックエンド**         | Hono · TypeScript · Zod · WebSocket |
| **フロントエンド**       | Next.js 15 · React 19 · TailwindCSS |
| **Web3**                 | Wagmi · Viem · RainbowKit           |
| **AI**                   | Anthropic Claude API                |
| **決済**                 | USDC (Circle) · x402 Protocol       |
| **データベース**         | SQLite (Drizzle ORM)                |

---

## 📁 プロジェクト構成

```
zerokey-treasury/
├── packages/
│   ├── contracts/     # Solidityスマートコントラクト
│   │   └── src/
│   │       └── ZeroKeyGuard.sol
│   │
│   ├── backend/       # APIサーバー
│   │   └── src/
│   │       ├── routes/
│   │       │   ├── analyze.ts      # トランザクション分析
│   │       │   ├── a2a.ts          # A2A Gateway (予定)
│   │       │   └── x402.ts         # x402決済 (予定)
│   │       └── services/
│   │           ├── analyzer.ts     # LLM分析
│   │           └── firewall.ts     # ポリシーチェック (予定)
│   │
│   ├── frontend/      # ダッシュボード
│   │   └── src/app/
│   │       ├── page.tsx            # Dashboard
│   │       ├── marketplace/        # プロバイダ一覧 (予定)
│   │       └── negotiate/          # A2A交渉UI (予定)
│   │
│   └── shared/        # 共有型
│
└── docs/
    ├── DESIGN.md              # 設計書
    ├── ARCHITECTURE.md        # アーキテクチャ詳細
    └── IMPLEMENTATION_PLAN.md # 実装計画
```

---

## 📖 ドキュメント

| ドキュメント                            | 説明                               |
| --------------------------------------- | ---------------------------------- |
| [設計書](docs/DESIGN.md)                | プロダクトコンセプトとユースケース |
| [アーキテクチャ](docs/ARCHITECTURE.md)  | システム構成とデータフロー         |
| [実装計画](docs/IMPLEMENTATION_PLAN.md) | 12日間の開発ロードマップ           |
| [CLAUDE.md](CLAUDE.md)                  | AI開発ガイド                       |

---

## 🗓️ 実装ロードマップ

| Phase | 内容                                               | 期間      | 状態 |
| ----- | -------------------------------------------------- | --------- | ---- |
| 1     | 基盤整備（analyzer.ts → API直接、プロバイダDB）    | Day 1-2   | 🔄   |
| 2     | A2A Gateway（サービスディスカバリ、交渉WebSocket） | Day 3-4   | ⏳   |
| 3     | Firewall強化（LLMプロンプト、ポリシーチェック）    | Day 5-6   | ⏳   |
| 4     | x402 Payment（402ミドルウェア、USDC統合）          | Day 7-8   | ⏳   |
| 5     | Frontend UI（マーケットプレイス、交渉画面）        | Day 9-10  | ⏳   |
| 6     | 統合テスト & デモ                                  | Day 11-12 | ⏳   |

---

## 🎯 ターゲット: HackMoney 2026

| スポンサー | 賞金    | 適合度           |
| ---------- | ------- | ---------------- |
| **Circle** | $10,000 | ◎ USDC決済基盤   |
| **Yellow** | $15,000 | ○ State Channels |
| **LI.FI**  | $6,000  | ○ クロスチェーン |

---

## 🔒 セキュリティ

- **フェイルセーフ**: LLM障害時はデフォルトでブロック
- **オンチェーン強制**: `policyOracle`のみが決定を送信可能
- **監査証跡**: すべての決定がブロックチェーンイベントとして記録
- **予算管理**: 日次/単発の支出上限を設定可能

---

## 📄 ライセンス

MIT License - [LICENSE](LICENSE)

---

<p align="center">
  ETHGlobalのために❤️を込めて開発
</p>
